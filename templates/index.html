<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω File</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-md">
        <h1 class="text-2xl font-bold text-gray-700 mb-4">Qu·∫£n l√Ω File</h1>

        <!-- üîç T√¨m ki·∫øm File -->
        <h2 class="text-xl font-semibold text-gray-700 mt-4">T√¨m ki·∫øm File</h2>
        <div class="flex gap-2">
            <input id="searchInput" type="text" placeholder="Nh·∫≠p t·ª´ kh√≥a..." 
                   class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400">
            <button onclick="searchFiles()" 
                    class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">T√¨m ki·∫øm</button>
        </div>
        <div id="result" class="mt-4"></div>

        <!-- üì§ Upload File -->
        <h2 class="text-xl font-semibold text-gray-700 mt-6">T·∫£i L√™n File</h2>
        <input type="file" id="fileInput" class="mt-2 block w-full border p-2">
        <input type="text" id="uploadPath" placeholder="Nh·∫≠p th∆∞ m·ª•c (m·∫∑c ƒë·ªãnh: uploads)" 
               class="mt-2 block w-full border p-2">
        <button onclick="uploadFile()" 
                class="bg-green-500 text-white px-4 py-2 mt-2 rounded-lg hover:bg-green-600">Upload</button>

        <!-- üîÄ Chuy·ªÉn File ƒê·∫øn M√°y Remote -->
        <h2 class="text-xl font-semibold text-gray-700 mt-6">Chuy·ªÉn File ƒë·∫øn M√°y Remote</h2>
        <input type="file" id="remoteFileInput" class="mt-2 block w-full border p-2">
        <button onclick="transferFile()" 
                class="bg-purple-500 text-white px-4 py-2 mt-2 rounded-lg hover:bg-purple-600">Chuy·ªÉn File</button>
    </div>

    <script>
        // üü¢ T√¨m ki·∫øm file
        async function searchFiles() {
            const keyword = document.getElementById("searchInput").value.trim();
            if (keyword === "") {
                alert("Vui l√≤ng nh·∫≠p t·ª´ kh√≥a t√¨m ki·∫øm!");
                return;
            }

            const response = await fetch(`http://localhost:9090/file/search?keyword=${encodeURIComponent(keyword)}`);
            const resultDiv = document.getElementById("result");
            resultDiv.innerHTML = "";

            if (!response.ok) {
                resultDiv.innerHTML = `<p class="text-red-500 mt-2">Kh√¥ng t√¨m th·∫•y file n√†o.</p>`;
                return;
            }

            const data = await response.json();
            if (data.files && data.files.length > 0) {
                const list = document.createElement("ul");
                list.classList.add("mt-2", "space-y-2");

                data.files.forEach(file => {
                    const fileName = file.split('/').pop();
                    const listItem = document.createElement("li");
                    listItem.innerHTML = `<a href="http://localhost:9090/file/download/${encodeURIComponent(file)}"
                                          class="text-blue-500 hover:underline" download>${fileName}</a>`;
                    list.appendChild(listItem);
                });

                resultDiv.appendChild(list);
            } else {
                resultDiv.innerHTML = `<p class="text-red-500 mt-2">Kh√¥ng t√¨m th·∫•y file n√†o.</p>`;
            }
        }

        // üü¢ Upload file
        async function uploadFile() {
            const fileInput = document.getElementById("fileInput").files[0];
            const uploadPath = document.getElementById("uploadPath").value.trim() || "uploads";

            if (!fileInput) {
                alert("Vui l√≤ng ch·ªçn file!");
                return;
            }

            // N·∫øu ng∆∞·ªùi d√πng kh√¥ng nh·∫≠p, m·∫∑c ƒë·ªãnh l√† "uploads"
            if (uploadPath === "") {
                uploadPath = "uploads";
            }

            const formData = new FormData();
            formData.append("file", fileInput);
            formData.append("path", uploadPath)
            console.log(uploadPath)
            // T·∫°o URL ƒë·ªông theo th∆∞ m·ª•c
            const apiURL = `http://localhost:9090/file/upload`;

            try {
                const response = await fetch(apiURL, {
                    method: "POST",
                    body: formData
                });

                const result = await response.json();
                alert(result.message);
            } catch (error) {
                console.error("L·ªói upload:", error);
                alert("L·ªói khi t·∫£i file l√™n");
            }
        }

        // üü¢ Chuy·ªÉn file ƒë·∫øn m√°y remote
        async function transferFile() {
            const fileInput = document.getElementById("remoteFileInput").files[0];
            if (!fileInput) {
                alert("Vui l√≤ng ch·ªçn file!");
                return;
            }

            const formData = new FormData();
            formData.append("file", fileInput);

            try {
                const response = await fetch("http://localhost:9090/file/transfer", {
                    method: "POST",
                    body: formData,
                });

                const result = await response.json();
                console.log("API Response:", result);  // In response ƒë·ªÉ ki·ªÉm tra l·ªói

                if (!response.ok) {
                    console.error("Response status:", response.status);
                    console.error("Full response:", result);
                    throw new Error(result.message || "L·ªói kh√¥ng x√°c ƒë·ªãnh khi chuy·ªÉn file");
                }

                alert("Chuy·ªÉn file th√†nh c√¥ng!");
            } catch (error) {
                console.error("L·ªói chuy·ªÉn file:", error);
                alert("L·ªói chuy·ªÉn file: " + error.message);
            }
        }
    </script>
</body>
</html>
